## HTTP代理原理
HTTP代理存在两种形式，分别简单介绍如下：
1. 第一种是RFC 7230（即修订后的RFC 2616, HTTP/1.1协议的第一部分）描述的普通代理。这种代理扮演的是[中间人]角色，对于连接到它的客户端来说，它是服务端；对于要连接的服务端来说，它是客户端。它就负责在两端之间来回传送HTTP报文。
2. 第二种是Tunneling TCP based protocols through Web proxy servers（通过Web代理服务器用隧道方式传输基于TCP的协议）描述的隧道代理。它通过HTTP协议正文部分(Body)完成通讯，以HTTP的方式实现任意基于TCP的应用层协议代理。这种代理使用HTTP的CONNECT方法建立连接，但CONNECT最开始并不是RFC2616-HTTP/1.1的一部分，直到2014年发布的HTTP/1.1修订版中，才增加了对CONNECT及隧道代理的描述。

#### 普通代理
```
HTTP客户端向代理发送请求报文，代理服务器需要正确地处理请求和连接，同时向服务器发送请求，并将收到的响应转发给客户端。
```

##### 正向代理
正向代理是一个位于客户端[用户A]和原始服务器[服务器B]之间的服务器[代理服务器Z]，为了从原始服务器取得内容，用户A向代理服务器Z发送一个请求并指定目标(服务器B)，然后代理服务器Z向服务器B转发请求并将获得的内容返回给客户端。使用正向代理，需要显式的指定代理，手动修改浏览器或操作系统相关设置。

使用正向代理服务器作用主要由以下几点：
1. 访问本无法访问的服务器B(越狱翻墙)
2. 加速访问服务器B
3. Cache(缓存)作用
4. 客户端访问授权
5. 隐藏访问者的行踪

##### 反向代理
反向代理正好与正向代理相反，对于客户端而言代理服务器就像是原始服务器，并且客户端不需要进行任何特别的设置。客户端向反向代理的命名空间(name-space)中的内容发送普通请求，接着反向代理将判断向何处(原始服务器)转交请求，并将获得的内容返回给客户端。一般使用反向代理后，需要通过修改 DNS 让域名解析到代理服务器 IP，这时浏览器无法察觉到真正服务器的存在，当然也就不需要修改配置了。

使用反向代理服务器作用主要由以下几点：
1. 保护和隐藏原始资源服务器
2. 负载均衡

#### 隧道代理（透明代理）
```
HTTP客户端通过CONNECT方法请求隧道代理，创建一条到达任意目的服务器和端口的TCP连接，并对客户端和服务器之间的后继数据进行盲转发。
```

假如我通过代理访问 A 网站，浏览器首先通过 CONNECT 请求，让代理创建一条到 A 网站的 TCP 连接；一旦 TCP 连接建好，代理无脑转发后续流量即可。所以这种代理，理论上适用于任意基于 TCP 的应用层协议，HTTPS 网站使用的 TLS 协议当然也可以。这也是这种代理为什么被称为隧道的原因。对于 HTTPS 来说，客户端透过代理直接跟服务端进行 TLS 握手协商密钥，所以依然是安全的
